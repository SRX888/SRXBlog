>�����������һ������дֵ��������������������ܻᱻ��һ���߳�����ȡ���������һ��������ֵ��������ֵ������ǰ������һ���߳�д��ģ���ʱ��ͱ���ʹ��ͬ����


- **sychronized**

�� Java���Ե�**�ؼ���**��������������һ����������һ��������ʱ���ܹ���֤��ͬһʱ�����ֻ��һ���߳�ִ�иöδ��룬������ **�����������JVMʵ��ͬ��**��
���� synchronized ����������ʹ���ṩ�˶���ÿ��������ص���ʽ���������ķ��ʣ���ȴǿ����������ȡ���ͷž�Ҫ������һ����ṹ�У�����ȡ�˶����ʱ�����Ǳ������෴��˳���ͷţ��ұ�����������������ȡʱ��ͬ�Ĵʷ���Χ���ͷ���������

> ����ͨ���ڷ��������м��� synchronized�ؼ��������� synchronized ������
> 
����synchronized �������ƶ����Ա�����ķ��ʣ�ÿ����ʵ����Ӧһ������ÿ�� synchronized �����������õ��ø÷�������ʵ����������
ִ�У����������߳�����������һ��ִ�У��Ͷ�ռ������ֱ���Ӹ÷�������ʱ�Ž����ͷţ��˺��������̷߳��ܻ�ø��������½����ִ��
״̬�����ֻ���ȷ����ͬһʱ�̶���ÿһ����ʵ��������������Ϊ synchronized �ĳ�Ա����������ֻ��һ�����ڿ�ִ��״̬����Ϊ����ֻ��һ���ܹ���ø���ʵ����Ӧ���������Ӷ���Ч���������Ա�����ķ��ʳ�ͻ��ֻҪ���п��ܷ������Ա�����ķ�����������Ϊ synchronized��
> 
> 
����synchronized ������ȱ�ݣ�����һ����ķ�������Ϊsynchronized ������Ӱ��Ч�ʣ����͵أ������߳���ķ��� run() ����Ϊ��synchronized ���������̵߳���������������һֱ�����У���˽��������Ա����κ� synchronized �����ĵ��ö���Զ����ɹ���

  ����

 �������synchronized ������ȱ��

����

> ͨ�� synchronized�ؼ���������synchronized �顣
```
synchronized(lock) {
// ���ʻ��޸ı��������Ĺ���״̬
}
```
> ���еĴ�������ö��� syncObject ����ʵ�����ࣩ��������ִ�С����ڿ�������������飬�ҿ�����ָ�������Ķ��󣬹�����Խϸߡ� 


���������������̷߳���ͬһ�������е����synchronized(this)ͬ�������ʱ��һ��ʱ����ֻ����һ���̵߳õ�ִ�С���һ���̱߳���ȴ���ǰ�߳�ִ�������������Ժ����ִ�иô���顣

������һ���̷߳��ʶ����һ��synchronized(this)ͬ�������ʱ����һ���߳���Ȼ���Է��ʸö����еķ�synchronized(this)ͬ������顣�����̶߳Զ�������������synchronized(this)ͬ�������ķ��ʽ���������

��������߳̽������߳��Ѿ�ӵ�еļ���������� synchronized �飬�������̼߳������У����߳��˳��ڶ��������ߺ����� synchronized ���ʱ�򣬲��ͷ�����ֻ���߳��˳�������ļ���������ĵ�һ�� synchronized ��ʱ�����ͷ�����

���������δ�����ʱ����Ҫһ��reference������Ϊ���Ķ���.
���������η�����ʱ��Ĭ���ǵ�ǰ������Ϊ���Ķ���.
������������ʱ��Ĭ���ǵ�ǰ���Class������Ϊ���Ķ���.

 - **lock**

����Lock �ӿ�ʵ���ṩ�˱�ʹ�� synchronized ���������ɻ�õĸ��㷺��������������ʵ����������Ľṹ�����Ծ��в��ܴ�����ԣ�����֧�ֶ����ص� Condition ������Ӳ���������������CPUָ��ʵ��ͬ��������


> ʲô��Condition ��
> Condition �ӿڽ� Object ������������wait��notify �� notifyAll���ֽ�ɽ�Ȼ��ͬ�Ķ����Ա�ͨ������Щ���������� Lock ʵ�����ʹ�ã�Ϊÿ�������ṩ����ȴ� set��wait-set�������У�Lock ����� synchronized ����������ʹ�ã�Condition ����� Object ������������ʹ�á�

������Ȼ synchronized ���������ķ�Χ����ʹ��ʹ�ü���������̷����˺ܶ࣬���һ����������˺ܶ��漰�����ĳ�����̴��󣬵���ʱҲ��Ҫ�Ը�Ϊ���ķ�ʽʹ���������磬ĳЩ�����������ʵ����ݽ�����㷨Ҫ��ʹ�� "hand-over-hand" �� "chain locking"����ȡ�ڵ� A ������Ȼ���ٻ�ȡ�ڵ� B ������Ȼ���ͷ� A ����ȡ C��Ȼ���ͷ� B ����ȡ D���������ơ�Lock �ӿڵ�ʵ���������ڲ�ͬ�����÷�Χ�ڻ�ȡ���ͷţ����������κ�˳���ȡ���ͷŶ�������Ӷ�֧��ʹ�����ּ�����

������������Ե����ӣ�Ҳ�����˸�������Ρ���ʹ�ÿ�ṹ����ʧȥ��ʹ�� synchronized ���������ʱ����ֵ����Զ��ͷŹ��ܡ��ڴ��������£�Ӧ��ʹ��������䣺

```
������Lock l = ...; //lock�ӿڵ�ʵ�������
     l.lock();
     try {
         // access the resource protected by this lock
     } finally {
         l.unlock();
     }
```
  ��java.util.concurrent.locks�����кܶ�Lock��ʵ���࣬���õ���ReentrantLock��ReadWriteLock��ʵ����ReentrantReadWriteLock��.�����Ǿ���ʵ���࣬����java���Թؼ��֡�


 - 

**ReentrantLock**

����һ��������Ļ����� Lock����������ʹ�� synchronized ��������������ʵ�**��ʽ��������**��ͬ��һЩ������Ϊ�����壬�����ܸ�ǿ��

��������͵Ĵ������£�
����

```
 class X {
   private final ReentrantLock lock = new ReentrantLock();
   // ...

   public void m() { 
     lock.lock();  // block until condition holds
     try {
       // ... method body
     } finally {
       lock.unlock()
     }
   }
 }
```

> �����ԣ�ָ����ͬһ���̶߳����ͼ��ȡ����ռ�е����������ɹ������ͷ�����ʱ��ֱ������������㣬�����ͷ���ϡ�
> 
����ReentrantLock ��lock������2�֣�**�����ж���**��**��Ӧ�ж���**��������Ǵ����˺ܴ������ԡ����磺���A��B 2���߳�ȥ��������A�̵߳õ�������B�̵߳ȴ�������A�߳����ʱ��ʵ����̫������Ҫ�������� һֱ�����أ�B�߳̿��ܾͻ�Ȳ����ˣ����ж��Լ������ٵȴ�������ˣ�ת�������������顣���ʱ��ReentrantLock���ṩ��2�ֻ��ƣ���һ��B�߳��ж��Լ������߱���߳��ж�����������ReentrantLock ��ȥ��Ӧ��������B�̵߳ȴ���������ô�жϣ���ȫ�����߷磨synchronizedԭ�������ˣ����ڶ���B�߳��ж��Լ������߱���߳��ж�������ReentrantLock ����������жϣ����Ҳ��ٵȴ�������ĵ�������ȫ������
����

����ReentrantLock�����synchronized���������߼����ܣ�
����
�����ٵȴ����ж�
���������ڳ��������̳߳�ʱ�䲻�ͷ�����ʱ��,�ȴ����߳̿���ѡ������ȴ�.
��������

```
tryLock(long timeout, TimeUnit unit)
```
�������ڹ�ƽ��
��������������������˳����һ�λ������Ϊ��ƽ��.synchronized���Ƿǹ�ƽ��,ReentrantLock����ͨ�����캯��ʵ�ֹ�ƽ��.

```
new RenentrantLock(boolean fair)
```
������ƽ���ͷǹ�ƽ������2�ֻ��Ƶ���˼��������Ҳ���˽����ţ������ڶ��߳���˵����ƽ���������߳̽�����˳�򣬺�������̺߳����������ǹ�ƽ������˼���Ǻ��������Ҳ���Ժ�ǰ�ߵȴ������߳�ͬʱ��������Դ������Ч����������Ȼ�Ƿǹ�ƽ��Ч�ʸ��ߣ���Ϊ��ƽ����Ҫ�ж��ǲ����̶߳��еĵ�һ���Ż����̻߳������
����
�����۰󶨶��Condition
������ͨ�����newCondition���Ի�ö��Condition����,���Լ򵥵�ʵ�ֱȽϸ��ӵ��߳�ͬ���Ĺ���.ͨ��await(),signal();

 - **synchronized��lock���÷�������**
��
��synchronized���йܸ�JVMִ�еģ���lock��javaд�Ŀ������Ĵ��롣
��
��synchronizedԭʼ���õ���CPU���������ƣ����̻߳�õ��Ƕ�ռ������ռ����ζ�������߳�ֻ�������������ȴ��߳��ͷ���������CPUת���߳�����ʱ�������߳��������л������кܶ��߳̾�������ʱ�򣬻�����CPUƵ�����������л�����Ч�ʺܵ͡���
��
��Lock�õ����ֹ�����ʽ��ÿ�β��������Ǽ���û�г�ͻ��ȥ���ĳ������������Ϊ��ͻʧ�ܾ����ԣ�ֱ���ɹ�Ϊֹ��

��ReentrantLock������finally���ͷ����������������أ�����Ƕ���˵ʹ��synchronized���Ӽ򵥣���������©���߳���

��ReentrantLock�ṩ�˿���ѯ�������������Գ��Ե�ȥȡ���������ȡ�óɹ����������ȡ�ò��ɹ������Ե��´����е�ʱ�������Բ����ײ�����������synchronized��һ������������Ҫô�ɹ���Ҫôһֱ���������Ը����ײ���������

��synchronized�Ļ������ķ�Χ������������synchronized�鲿�֣���Lock��Ϊ�Ƿ������ã����Կ緽��������Ը���

��һ������¶�����synchronizedԭ��ʵ��ͬ���������������ʹ��ReentrantLock
������
��������ĳ���߳��ڵȴ�һ�����Ŀ���Ȩ�����ʱ����Ҫ�ж�
����������Ҫ�ֿ�����һЩwait-notify��ReentrantLock�����ConditionӦ�ã��ܹ�����notify�ĸ��߳�
������ �۾��й�ƽ�����ܣ�ÿ���������̶߳����ŶӵȺ�
